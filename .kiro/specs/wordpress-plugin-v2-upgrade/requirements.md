# 需求文档

## 介绍

WordPress插件V2.0升级项目旨在在现有基础文章管理系统上构建完整的多用户权限管理、多站点管理、内容审核和自动化运维功能。该升级将现有的单用户、单站点系统转换为支持多用户协作、多站点发布、分级审核的企业级内容管理解决方案。

## 术语表

- **系统**: WordPress插件V2.0升级系统
- **管理员**: 具有完整系统权限的用户角色
- **普通用户**: 具有受限权限的用户角色
- **文章管理器**: 负责文章CRUD操作的系统组件
- **权限验证器**: 负责用户权限校验的系统组件
- **站点管理器**: 负责多WordPress站点管理的系统组件
- **审核引擎**: 负责内容审核和敏感词检测的系统组件
- **API管理器**: 负责DeepSeek API集成和管理的系统组件
- **清理调度器**: 负责自动文章清理的系统组件
- **统计分析器**: 负责用户发布量统计的系统组件
- **敏感词库**: 分层管理的敏感词数据库

## 需求

### 需求 1: 用户权限管理系统

**用户故事:** 作为系统管理员，我希望能够管理不同角色的用户权限，以便控制系统访问和操作权限。

#### 验收标准

1. 当管理员创建新用户时，系统应当允许指定用户角色（管理员或普通用户）
2. 当普通用户尝试访问管理员功能时，系统应当拒绝访问并显示权限不足提示
3. 当用户执行任何操作时，权限验证器应当验证用户身份和操作权限
4. 当普通用户查看文章列表时，系统应当仅显示该用户创建的文章
5. 当管理员查看文章列表时，系统应当显示所有用户的文章

### 需求 2: 文章权限控制

**用户故事:** 作为普通用户，我希望能够管理自己的文章，同时确保我无法访问其他用户的文章。

#### 验收标准

1. 当普通用户创建文章时，系统应当将文章状态设置为"待审核"
2. 当普通用户尝试编辑他人文章时，系统应当拒绝操作并返回权限错误
3. 当管理员审核文章时，系统应当允许修改文章状态为"已发布"或"已拒绝"
4. 当用户未登录时，系统应当阻止文章提交并要求登录
5. 当普通用户删除自己的文章时，系统应当同步删除对应WordPress站点上的文章

### 需求 3: 多WordPress站点管理

**用户故事:** 作为管理员，我希望能够配置和管理多个WordPress站点，以便用户可以选择发布目标。

#### 验收标准

1. 当管理员添加新站点时，系统应当验证站点连接性并存储加密的认证信息
2. 当用户发布文章时，系统应当提供站点选择界面并显示可用站点列表
3. 当文章发布到指定站点时，系统应当使用该站点的默认栏目ID
4. 当站点连接失败时，系统应当记录错误日志并通知管理员
5. 当管理员删除站点配置时，系统应当检查是否有关联文章并给出警告

### 需求 4: DeepSeek API集成管理

**用户故事:** 作为管理员，我希望能够安全地管理DeepSeek API配置，以便系统能够进行内容审核。

#### 验收标准

1. 当管理员配置API密钥时，系统应当加密存储密钥信息
2. 当管理员查询API余额时，系统应当实时返回当前可用额度
3. 当API调用失败时，系统应当记录错误信息并继续其他功能运行
4. 当API密钥无效时，系统应当提示管理员更新配置
5. 当系统启动时，API管理器应当验证已配置密钥的有效性

### 需求 5: 文章自动清理功能

**用户故事:** 作为管理员，我希望系统能够自动清理过期文章，以便维护数据库性能和存储空间。

#### 验收标准

1. 当管理员设置清理阈值时，系统应当保存配置并应用于后续清理任务
2. 当定时任务运行时，清理调度器应当识别超过阈值天数的文章
3. 当文章被自动删除时，系统应当同步删除WordPress站点上的对应文章
4. 当清理操作完成时，系统应当记录删除日志包含时间、标题和站点信息
5. 当管理员手动触发清理时，系统应当立即执行清理并显示操作结果

### 需求 6: 用户发布量统计

**用户故事:** 作为管理员，我希望能够查看用户发布统计数据，以便了解系统使用情况和用户活跃度。

#### 验收标准

1. 当管理员访问统计页面时，系统应当显示按日/月维度的用户发布数据
2. 当生成统计报表时，统计分析器应当包含总提交数、审核通过数、敏感词拦截数
3. 当管理员导出数据时，系统应当生成CSV格式的统计报表
4. 当统计数据更新时，系统应当实时反映最新的发布情况
5. 当查询特定时间范围时，系统应当返回该时间段内的准确统计数据

### 需求 7: 内容审核等级管理

**用户故事:** 作为管理员，我希望能够调整内容审核的严格程度，以便根据业务需求灵活控制内容质量。

#### 验收标准

1. 当管理员设置审核等级为"宽松"时，系统应当仅拦截高危敏感词
2. 当管理员设置审核等级为"默认"时，系统应当拦截高危词并替换普通敏感词
3. 当管理员设置审核等级为"严格"时，系统应当拦截所有敏感词并拒绝提交
4. 当审核等级修改后，审核引擎应当立即应用新规则无需重启
5. 当内容触发审核规则时，系统应当根据当前等级执行相应处理策略

### 需求 8: 敏感词库管理

**用户故事:** 作为管理员，我希望能够管理系统的敏感词库，以便维护内容审核的准确性和时效性。

#### 验收标准

1. 当系统初始化时，敏感词库应当包含预置的高危和普通敏感词
2. 当管理员查看敏感词时，系统应当区分显示高危和普通敏感词标签
3. 当管理员添加自定义敏感词时，系统应当允许指定词汇类型
4. 当管理员导入敏感词文件时，系统应当验证格式并批量添加词汇
5. 当管理员搜索敏感词时，系统应当支持关键词模糊匹配

### 需求 9: 系统兼容性和用户体验

**用户故事:** 作为系统用户，我希望新功能能够与现有功能无缝集成，并提供良好的操作体验。

#### 验收标准

1. 当用户使用现有敏感词屏蔽功能时，系统应当保持原有行为不变
2. 当用户执行关键操作时，系统应当提供二次确认对话框
3. 当系统与其他WordPress插件共存时，系统应当避免功能冲突
4. 当用户界面加载时，系统应当提供清晰的功能导航和操作指引
5. 当操作失败时，系统应当提供明确的错误信息和解决建议

### 需求 10: 操作审计和日志记录

**用户故事:** 作为管理员，我希望系统能够记录关键操作的审计日志，以便进行问题追溯和安全审计。

#### 验收标准

1. 当管理员修改审核等级时，系统应当记录操作人、时间和修改内容
2. 当管理员修改敏感词库时，系统应当记录详细的变更信息
3. 当系统执行自动清理时，系统应当记录清理操作的完整日志
4. 当用户权限变更时，系统应当记录权限修改的审计信息
5. 当系统发生异常时，系统应当记录错误日志便于问题诊断